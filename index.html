<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mendip Vale Medical Practice – Full ODS Data</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background:white; color:#222; }
    h1 { color:#192543; border-bottom:3px solid #192543; font-weight:bold; }
    table { width:100%; border-collapse:collapse; margin-top:20px; border:2px solid #192543; }
    th { background:#7fc28f; color:white; padding:8px; text-align:left; }
    td { border:1px solid #ddd; padding:8px; vertical-align:top; }
    tr:hover { background:#f0f9f0; }
  </style>
</head>
<body>

  <h1>Mendip Vale Medical Practice (ODS Full Data)</h1>

  <table>
    <thead>
      <tr>
        <th>Name</th><th>ODS Code</th><th>Record Class</th><th>Status</th>
        <th>Legal Start</th><th>Legal End</th><th>Operational Start</th><th>Operational End</th>
        <th>Postcode</th><th>Address</th><th>Roles</th><th>Contacts</th>
        <th>Relationships</th><th>Succession</th><th>Created On</th><th>Last Change</th><th>RefOnly</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="17">Loading data...</td></tr>
    </tbody>
  </table>

  <script>
    async function loadFullData() {
      const url = 'https://directory.spineservices.nhs.uk/ORD/2-0-0/organisations?Name=MENDIP%20VALE%20MEDICAL%20PRACTICE&Limit=5';
      const res = await fetch(url, { headers:{Accept:'application/json'} });
      const data = await res.json();
      const orgs = data.Organisations || [];
      const tbody = document.getElementById('rows');
      tbody.innerHTML = '';

      if (!orgs.length) {
        tbody.innerHTML = '<tr><td colspan="17">No results found.</td></tr>';
        return;
      }

      orgs.forEach(org => {
        const recClass = org.OrgRecordClass;
        const status = org.Status;
        const rs = org.Date?.find(d=>d.Type==='Legal')||{};
        const os = org.Date?.find(d=>d.Type==='Operational')||{};
        const geo = org.GeoLoc?.Location || {};
        const address = [geo.AddrLn1,geo.AddrLn2,geo.AddrLn3,geo.Town,geo.County].filter(Boolean).join(', ');

        const roles = (org.Roles||[])
          .map(r => `${r.id} (${r.displayName})`)
          .join('; ');
        const contacts = (org.Contacts||[])
          .map(c => `${c.Type}:${c.Value}`).join('; ');
        const rels = (org.Relationships||[])
          .map(r=>`${r.RelationshipType}→${r.Target.OrgId.extension}`).join('; ');
        const succ = (org.Succession||[])
          .map(s=>`${s.Type}→${s.Target.OrgId.extension}`).join('; ');

        tbody.innerHTML += `
          <tr>
            <td>${org.Name||''}</td>
            <td>${org.OrgId.extension}</td>
            <td>${recClass}</td>
            <td>${status}</td>
            <td>${rs.Start||''}</td><td>${rs.End||''}</td>
            <td>${os.Start||''}</td><td>${os.End||''}</td>
            <td>${geo.PostCode||org.PostCode||''}</td>
            <td>${address}</td>
            <td>${roles}</td>
            <td>${contacts}</td>
            <td>${rels}</td>
            <td>${succ}</td>
            <td>${org.CreatedOn||''}</td>
            <td>${org.LastChangeDate||''}</td>
            <td>${org.refOnly||false}</td>
          </tr>`;
      });
    }

    loadFullData();
  </script>

</body>
</html>
